From 6f0a1d5c216d28997e1fd4590b194e70a921779d Mon Sep 17 00:00:00 2001
From: Benjamin Kaduk <bkaduk@akamai.com>
Date: Tue, 7 Sep 2021 14:21:22 -0700
Subject: [PATCH 53/63] QUIC: use SSL_IS_QUIC() in more places

---
 doc/man3/SSL_CTX_set_quic_method.pod | 2 +-
 ssl/statem/extensions_clnt.c         | 2 +-
 ssl/statem/statem_clnt.c             | 2 +-
 3 files changed, 3 insertions(+), 3 deletions(-)

diff --git a/doc/man3/SSL_CTX_set_quic_method.pod b/doc/man3/SSL_CTX_set_quic_method.pod
index f12aa8662b..aab5e38889 100644
--- a/doc/man3/SSL_CTX_set_quic_method.pod
+++ b/doc/man3/SSL_CTX_set_quic_method.pod
@@ -103,7 +103,7 @@ the client will send both extensions.
 SSL_get_quic_transport_version() returns the value set by
 SSL_set_quic_transport_version().
 
-SSL_get_peer_quic_transport_version() returns the version the that was 
+SSL_get_peer_quic_transport_version() returns the version the that was
 negotiated.
 
 SSL_set_quic_early_data_enabled() enables QUIC early data if a nonzero
diff --git a/ssl/statem/extensions_clnt.c b/ssl/statem/extensions_clnt.c
index e7c54e633e..caeb818a37 100644
--- a/ssl/statem/extensions_clnt.c
+++ b/ssl/statem/extensions_clnt.c
@@ -1944,7 +1944,7 @@ int tls_parse_stoc_early_data(SSL *s, PACKET *pkt, unsigned int context,
          * QUIC server must send 0xFFFFFFFF or it's a PROTOCOL_VIOLATION
          * per RFC9001 S4.6.1
          */
-        if (s->quic_method != NULL && max_early_data != 0xFFFFFFFF) {
+        if (SSL_IS_QUIC(s) && max_early_data != 0xFFFFFFFF) {
             SSLfatal(s, SSL_AD_ILLEGAL_PARAMETER, SSL_R_INVALID_MAX_EARLY_DATA);
             return 0;
         }
diff --git a/ssl/statem/statem_clnt.c b/ssl/statem/statem_clnt.c
index f9235d4160..9d925091b6 100644
--- a/ssl/statem/statem_clnt.c
+++ b/ssl/statem/statem_clnt.c
@@ -906,7 +906,7 @@ int ossl_statem_client_construct_message(SSL *s, WPACKET *pkt,
     case TLS_ST_CW_END_OF_EARLY_DATA:
 #ifndef OPENSSL_NO_QUIC
         /* QUIC does not send EndOfEarlyData, RFC9001 S8.3 */
-        if (s->quic_method != NULL) {
+        if (SSL_IS_QUIC(s)) {
             *confunc = NULL;
             *mt = SSL3_MT_DUMMY;
             break;
-- 
2.42.0

